<!DOCTYPE html>
<html>
<head>
  <title>Simple 3 Letter Video Call</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #111;
      color: white;
    }
    video {
      width: 45%;
      margin: 10px;
      border-radius: 10px;
      background: black;
    }
    input, button {
      padding: 10px;
      font-size: 18px;
      margin: 5px;
      border-radius: 6px;
      border: none;
    }
    button {
      cursor: pointer;
      background: #4CAF50;
      color: white;
    }
  </style>
</head>
<body>

  <h1>3 Letter Video Call</h1>

  <input id="roomInput" maxlength="3" placeholder="abc" />
  <button onclick="startCall()">Join</button>

  <div>
    <video id="localVideo" autoplay muted playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
  </div>

<script>
let peer;
let localStream;

async function startCall() {
  const roomId = document.getElementById("roomInput").value.toLowerCase();

  if (roomId.length !== 3) {
    alert("Room ID must be exactly 3 letters.");
    return;
  }

  // Get camera + mic
  localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  document.getElementById("localVideo").srcObject = localStream;

  peer = new Peer(roomId);

  peer.on('open', id => {
    console.log("Connected with ID:", id);
  });

  // If someone calls you
  peer.on('call', call => {
    call.answer(localStream);
    call.on('stream', remoteStream => {
      document.getElementById("remoteVideo").srcObject = remoteStream;
    });
  });

  peer.on('error', async err => {
    // If ID already exists, join instead
    if (err.type === 'unavailable-id') {
      peer = new Peer();

      peer.on('open', id => {
        const call = peer.call(roomId, localStream);

        call.on('stream', remoteStream => {
          document.getElementById("remoteVideo").srcObject = remoteStream;
        });
      });
    }
  });
}
</script>

</body>
</html>
